<div class="modal-backdrop" *ngIf="task">
  <div 
    class="modal-content"
    (touchstart)="onTouchStart($event)"
    (touchmove)="onTouchMove($event)"
    (touchend)="onTouchEnd()"
  >
    <div class="modal-header">
      <h2 class="modal-title" *ngIf="!isEditing">{{ task.title }}</h2>
      <input 
        type="text" 
        [(ngModel)]="editTitle" 
        placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏"
        class="modal-title-edit"
        *ngIf="isEditing"
        autofocus
      />
      <button class="btn-close" (click)="close.emit()" title="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
    </div>

    <div class="modal-body" *ngIf="!isEditing">
      <div class="task-meta">
        <span class="task-date">–°–æ–∑–¥–∞–Ω–æ: {{ task.createdAt | date:'dd.MM.yyyy HH:mm' }}</span>
      </div>
      <div class="task-image" *ngIf="task.image" (click)="openImageFullscreen(task.image)">
        <img [src]="task.image" [alt]="task.title" />
      </div>
      <div class="task-description" *ngIf="task.text" [innerHTML]="task.text"></div>
      <div class="task-description empty" *ngIf="!task.text">
        <p class="no-description">–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</p>
      </div>
    </div>

    <div class="modal-body editing" *ngIf="isEditing">
      <div class="form-group">
        <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</label>
        <div class="image-upload-section">
          <div class="current-image" *ngIf="selectedImagePreview || task.image">
            <img [src]="selectedImagePreview || task.image" alt="Preview" />
            <button 
              type="button" 
              class="btn-remove-image" 
              (click)="removeImage()"
              title="–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
            >
              ‚úï
            </button>
          </div>
          <input 
            type="file" 
            (change)="onFileSelected($event)" 
            accept="image/*"
            class="file-input"
            #fileInput
          />
          <button 
            type="button" 
            class="btn-choose-file" 
            (click)="fileInput.click()"
          >
            üì∑ {{ (selectedImagePreview || task.image) ? '–ó–∞–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ' : '–í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ' }}
          </button>
        </div>
      </div>
      <div class="form-group">
        <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
        <textarea 
          [(ngModel)]="editText" 
          placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏"
          class="edit-text-large"
          rows="10"
        ></textarea>
      </div>
    </div>

    <div class="modal-footer">
      <div class="footer-left">
        <button class="btn-respond" (click)="respond.emit()" *ngIf="!isEditing" [disabled]="isSaving || isDeleting">
          ‚úâÔ∏è –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è
        </button>
        <button class="btn-danger" *ngIf="isAdmin && isEditing" (click)="onDelete()" [disabled]="isSaving || isDeleting">
          <span *ngIf="!isDeleting">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</span>
          <span *ngIf="isDeleting" class="loading-text">‚è≥ –£–¥–∞–ª–µ–Ω–∏–µ...</span>
        </button>
      </div>
      <div class="footer-right">
        <button class="btn-secondary" *ngIf="!isEditing && isAdmin" (click)="startEdit()" [disabled]="isSaving || isDeleting">
          ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
        </button>
        <button class="btn-secondary" *ngIf="isEditing" (click)="cancelEdit()" [disabled]="isSaving || isDeleting">
          –û—Ç–º–µ–Ω–∞
        </button>
        <button class="btn-primary" *ngIf="isEditing" (click)="saveEdit()" [disabled]="isSaving || isDeleting">
          <span *ngIf="!isSaving">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span>
          <span *ngIf="isSaving" class="loading-text">‚è≥ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
<div class="image-fullscreen" *ngIf="fullscreenImage" (click)="closeImageFullscreen()">
  <button class="btn-close-fullscreen" (click)="closeImageFullscreen()" title="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
  <img [src]="fullscreenImage" alt="Fullscreen" (click)="$event.stopPropagation()" />
</div>
